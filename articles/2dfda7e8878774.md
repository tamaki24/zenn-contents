---
title: "DenoでサッとPreactを書く"
emoji: "🦕"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["zennfes2025free", "deno", "preact", "typescript"]
published: true
---

⚠️ **注意** `deno bundle`を使用するため、Deno2.4.0以降が必要です。
[Deno - Bundling](https://docs.deno.com/runtime/reference/bundling/)

# Preact + Deno
Deno環境で`deno bundle`コマンドを活用し、シンプルにPreactをブラウザで動かします。
以下の手順は、Deno 2.5.1 の環境で実行して作成しています。

## 1. プロジェクトの作成
まずはDenoのプロジェクトディレクトリを作成し、初期化します。

```bash
mkdir preact-deno
cd preact-deno

deno init
```

## 2. 設定ファイルの作成
`deno.json`に、Preactのインポート設定と、開発に必要なタスクを追加します。
まず、以下のコマンドでnpmパッケージをインポートしていきます。

```bash
deno add npm:preact npm:preact/hooks
```

実行すると、`deno.json`ファイルが自動的に更新され、`preact`と`preact/hooks`が importsに追加されます。
[Deno - add](https://docs.deno.com/runtime/reference/cli/add/)

次に、`deno.json`に`compilerOptions`と、開発・ビルド用の`tasks`を追加します。完成した`deno.json`は以下のようになります。

```json
{
  "imports": {
    "preact": "npm:preact@10.20.2",
    "preact/hooks": "npm:preact@10.20.2/hooks"
  },
  "tasks": {
    "dev": "deno run --allow-net --allow-read https://deno.land/std@0.218.2/http/file_server.ts",
    "bundle": "deno bundle -o dist/bundle.js main.tsx"
  },
  "compilerOptions": {
    "jsx": "react-jsx",
    "jsxImportSource": "preact"
  }
}
```

* compilerOptions: DenoにJSXをコンパイルする方法を伝えます。
* tasks: devとbundleという2つのタスクを定義しました。`deno task dev`で開発サーバーを起動し、`deno task bundle`でJSX構文をブラウザが解釈できるJavaScriptコードに変換して、`bundle.js`を生成します。

## 3. Preactでmain.tsxを作成
以下の内容で`main.tsx`ファイルを作成します。

```ts
import { render } from "preact";
import { useState } from "preact/hooks";

function App() {
  const [count, setCount] = useState(0);
  return (
    <div>
      <h1>Hello from Preact + Deno</h1>
      <button onClick={() => setCount(count + 1)}>Count: {count}</button>
    </div>
  );
}

render(<App />, document.getElementById("app")!);
```
* render関数で画面に表示したいコンポーネントと、レンダリング先のHTML要素を指定しています。
* 末尾の`!`は、TypeScriptにおいて「この要素は必ず存在します」ということをコンパイラに伝える非nullアサーション演算子です。これにより、要素が見つからないことによるエラーを防いでいます。

## 4. index.htmlの作成
`index.html`ファイルを作成します。ここでは、バンドルされたJavaScriptファイルを読み込むように設定します。

```html
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8"/>
    <title>Preact + Deno</title>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="./dist/bundle.js"></script>
  </body>
</html>
```

## 5. アプリケーションのバンドル
`deno task bundle`コマンドを実行して、`main.tsx`をJavaScriptファイルにバンドルします。

```bash
deno task bundle
```

これにより、distディレクトリが作成され、`main.tsx`がバンドル・トランスパイルされて`dist/bundle.js`として出力されます。

## 6. 開発サーバーの起動
`deno task`コマンドで開発サーバーを起動します。

```bash
deno task dev

# 出力例：
Task dev deno run --allow-net --allow-read https://deno.land/std@0.218.2/http/file_server.ts
Listening on http://0.0.0.0:4507/ (http://localhost:4507/)
```

このコマンドは`deno.json`に定義されたdevタスクを実行します。
ブラウザで`http://localhost::4507/`にアクセスし、動作を確認してください。

## 7.ここまでのコード

https://github.com/tamaki24/preact-deno

